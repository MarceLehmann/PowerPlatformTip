<!-- Consent-gated Google Analytics (gtag.js) -->
<script>
(function() {
  function getCookie(name){
    const nameEQ=name+'='; const ca=document.cookie.split(';');
    for(let i=0;i<ca.length;i++){ let c=ca[i]; while(c.charAt(0)==' ') c=c.substring(1); if(c.indexOf(nameEQ)==0) return c.substring(nameEQ.length); }
    return null;
  }
  function loadGA(){
    if (window.__gaLoaded) return;
    window.__gaLoaded = true;
    var s=document.createElement('script');
    s.async=true; s.src='https://www.googletagmanager.com/gtag/js?id={{ site.analytics.google.tracking_id }}';
    document.head.appendChild(s);
    window.dataLayer = window.dataLayer || [];
    window.gtag = function(){ dataLayer.push(arguments); };
    gtag('js', new Date());
    gtag('config', '{{ site.analytics.google.tracking_id }}', {
      'anonymize_ip': {{ site.analytics.google.anonymize_ip | default: false }},
      'allow_ad_personalization_signals': false,
      'allow_google_signals': false
    });
  }
  if (getCookie('cookie_consent')==='accepted') {
    loadGA();
  } else {
    window.addEventListener('cookie-consent:accepted', loadGA);
  }
})();
</script>

<!-- CollectionPage Schema for Tag/Category Pages -->
{% if page.taxonomy and page.entries %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title | replace: '|', '&#124;' | strip_html | escape_once }}",
  "description": "{{ page.excerpt | default: page.description | markdownify | strip_html | strip_newlines | truncate: 160 | escape_once }}",
  "url": "{{ page.url | absolute_url }}",
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ site.url }}{{ site.baseurl }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "{{ page.taxonomy | capitalize }}",
        "item": "{{ site.url }}{{ site.baseurl }}/{{ page.taxonomy }}/"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "{{ page.title }}",
        "item": "{{ page.url | absolute_url }}"
      }
    ]
  },
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ page.entries.size }},
    "itemListElement": [
      {% for post in page.entries limit: 10 %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "item": {
          "@type": "TechArticle",
          "headline": "{{ post.title | replace: '|', '&#124;' | strip_html | escape_once }}",
          "url": "{{ post.url | absolute_url }}",
          "datePublished": "{{ post.date | date_to_xmlschema }}",
          "dateModified": "{{ post.last_modified_at | default: post.date | date_to_xmlschema }}",
          "author": {
            "@type": "Person",
            "name": "{{ post.author | default: site.author.name }}",
            "url": "{{ site.url }}{{ site.baseurl }}/about/"
          },
          "publisher": {
            "@type": "Organization",
            "name": "{{ site.title }}",
            "url": "{{ site.url }}{{ site.baseurl }}"
          },
          "description": "{{ post.excerpt | default: post.description | markdownify | strip_html | strip_newlines | truncate: 160 | escape_once }}"
        }
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.title }}",
    "url": "{{ site.url }}{{ site.baseurl }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.logo | default: '/assets/images/logo.png' | absolute_url }}"
    }
  },
  "about": {
    "@type": "Thing",
    "name": "{{ page.taxonomy }}: {{ page.title }}"
  }
}
</script>
{% endif %}
